var lg=console.log.bind(console),lgi=console.log.bind(console),lge=console.log.bind(console),lgw=console.log.bind(console),apiUrl="http://localhost/perpus/api/",settingModule=angular.module("SettingModule",[]);settingModule.factory("setting",["$rootScope","$q",function(e,o){return{set:function(e,o){return window.localStorage?("object"==typeof o&&(o=JSON.stringify(o)),window.localStorage[e]=o,!0):!1},get:function(e){if(window.localStorage){var o=window.localStorage[e];if(o)try{var t=JSON.parse(o);return t}catch(n){if("undefined"==o)return;return"false"==o?!1:o}if("undefined"==o)return;return"false"==o?!1:o}return!1},resolveOnlineImage:function(e){if(window.resolveLocalFileSystemURL){var t=o.defer(),n=e.split("/").lastValue;if(!n)return o.when(e);try{window.resolveLocalFileSystemURL(cordova.file.applicationStorageDirectory+n,function(e){console.log("get local image : "+cordova.file.applicationStorageDirectory+n);var o=e.toURL();t.resolve(o)},function(){if(FileTransfer){var o=new FileTransfer;o.download(e,cordova.file.applicationStorageDirectory+n,function(e){console.log("save online image : "+cordova.file.applicationStorageDirectory+n);var o=e.toURL();t.resolve(o)},function(o){console.log("failed save online image"),t.resolve(e)},!0,{})}else console.log("FileTransfer not supported"),t.resolve(e)})}catch(r){return o.when(e)}return t.promise}return console.log("resolveLocalFileSystemURL not supported"),o.when(e)}}}]),settingModule.run(["$rootScope","setting",function(e,o){e.setting=o}]);var userModule=angular.module("UserModule",[],["$httpProvider",function(e){e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded"}]);userModule.factory("user",["$http","$q","$rootScope","Upload","setting",function(e,o,t,n,r){function i(o){l=o,e.defaults.headers.common.token=l,window.localStorage["digilib-upi"]=l,console.log("change key",l)}function a(t,n){var r=o.defer();t+=t.indexOf("?")>=0?"&buzzdata="+(new Date).getTime().toString():"?buzzdata="+(new Date).getTime().toString();e.get(apiUrl+t).success(function(e){e.status?r.resolve(e.data):r.reject(e.message)})["catch"](function(e){r.reject(e)});return r.promise}function s(t,n){var r=o.defer();t+=t.indexOf("?")>=0?"&buzzdata="+(new Date).getTime().toString():"?buzzdata="+(new Date).getTime().toString();e.post(apiUrl+t,serialize(n)).success(function(e){e.status?r.resolve(e.data):r.reject(e.message)})["catch"](function(e){r.reject(e)});return r.promise}window.f=e;var l=window.localStorage["digilib-upi"]||"",c=!1,u=r.get("profile")||{};return e.defaults.headers.common.token=l,serialize=function(e,o){var t=[];for(var n in e)if(e.hasOwnProperty(n)){var r=o?o+"["+n+"]":n,i=e[n];t.push("object"==typeof i?serialize(i,r):encodeURIComponent(r)+"="+encodeURIComponent(i))}return t.join("&")},{get profile(){return u},set profile(e){u=e},getKey:function(){return l},setKey:function(e){i(e),e&&(c=!0),this.cek()},isLogin:function(){return lgi("isLogin",c),c},isLoginLocal:function(){return""!==l},login:function(t,n){var r=o.defer(),a=this,s={email:t,password:n};return e.post(apiUrl+"auth/login",serialize(s)).success(function(e){e.status?e.data&&e.data.token?(i(e.data.token),c=!0,a.cek(),r.resolve(!0)):r.reject("Gagal mengambil token login."):e.message&&"string"==typeof e.detail?r.reject(e.detail):r.reject("Username / Password salah")})["catch"](function(e){r.reject(e)}),r.promise},register:function(t){var n=o.defer(),r=this;return e.post(apiUrl+"auth/register",serialize(t)).success(function(e){e.status?e.data&&e.data.token?(i(e.data.token),c=!0,r.cek(),n.resolve(!0)):n.reject("Gagal mengambil token login."):e.message&&"string"==typeof e.message?n.reject(e.message):n.reject("Username / Password salah")})["catch"](function(e){n.reject(e)}),n.promise},changeAvatar:function(e){var t=o.defer();return n.upload({url:apiUrl+"changeAvatar",method:"POST",file:e,sendFieldsAs:"form",fields:{}}).progress(function(e){var o=parseInt(100*e.loaded/e.total);t.notify(o)}).success(function(e,o,n,r){console.log(e),e.status?t.resolve(e.data):t.reject(!1)}).error(function(e,o,n,r){console.log(e),t.reject(!1)}),t.promise},cekLocal:function(){return lgi("cek local",l),""===l?o.when({status:!1}):o.when({status:!0})},cek:function(){var n=o.defer(),a=this;return""===l?o.when({status:!1}):(e.get(apiUrl+"user").success(function(e,o){lgi("cek login",e.status,e.data),e.status?(c=!0,a.profile=e.data,a.profile.member_image?r.resolveOnlineImage(a.profile.member_image).then(function(e){a.profile.member_image=e}):a.profile.member_image="img/default-user-image.png",r.set("profile",a.profile),n.resolve(e.data),t.$broadcast("onuser",a.profile)):e.hasOwnProperty("status")?(i(""),n.resolve(e)):e.hasOwnProperty("message")?n.reject(e.message):n.reject(JSON.stringify(e))})["catch"](function(e){n.reject(JSON.stringify(e))}),n.promise)},changeKey:i,logout:function(){var t=o.defer();e.get(apiUrl+"logout").success(function(e){c=!1,i(""),t.resolve(!0)})["catch"](function(e){c=!1,i(""),t.resolve(!0)});return t.promise},saveBio:function(e){return s("user",e)},getBooks:function(e){var o="";return e&&(o="?"+serialize(e)),a("books"+o)},getBook:function(e){return a("book/"+e)},getBookRate:function(e){return a("book/"+e+"/rate")},setBookRate:function(e,o){return s("book/"+e+"/rate",{rate:o})},getBookComments:function(e){return a("book/"+e+"/comments")},setBookComments:function(e,o){return s("book/"+e+"/comment",{text:o})},setBookFav:function(e){return s("book/"+e+"/favorit")},unsetBookFav:function(e){return s("book/"+e+"/unfavorit")},getBookLoans:function(){return a("user/books")},getMessageList:function(){return a("messages")},getMessageTexts:function(e){return a("message/"+e)},postMessage:function(e,o){return s("message",{member_id:e,text:o})},getNotif:function(){return a("notif")},postNotifRead:function(e){return s("notif/read",{notif_id:e})}}}]),userModule.run(["user","$rootScope","$http","$ionicPlatform",function(e,o,t,n){n.ready(function(){console.log("Ionic Ready"),o.user=e,e.cek()})}]);var mainApp=angular.module("digilib",["ionic","controllers","UserModule","SettingModule","ngFileUpload"]);mainApp.run(["$ionicConfig","$ionicPlatform","$ionicHistory","$rootScope",function(e,o,t,n){o.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()}),screen.lockOrientation&&screen.lockOrientation("portrait")}]),mainApp.config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider",function(e,o,t){t.tabs.style("standard").position("bottom"),t.navBar.alignTitle("center").positionPrimaryButtons("left"),e.state("app",{url:"/app","abstract":!0,templateUrl:"templates/index.html",controller:"IndexController"}).state("app.koleksi",{url:"/koleksi",views:{historyRoot:!0,content:{templateUrl:"templates/koleksi.html",controller:"KoleksiController"}}}).state("app.profil",{url:"/profil",views:{content:{templateUrl:"templates/profil.html",controller:"ProfilController"}}}).state("app.buku",{url:"/buku/:id",views:{content:{templateUrl:"templates/buku.html",controller:"BukuController"}}}).state("app.buku-review",{url:"/buku/:id/review",views:{content:{templateUrl:"templates/buku-review.html",controller:"BukuReviewController"}}}).state("app.pesan",{url:"/pesan",views:{content:{templateUrl:"templates/pesan.html",controller:"PesanController"}}}).state("app.pemberitahuan",{url:"/pemberitahuan",views:{content:{templateUrl:"templates/pemberitahuan.html",controller:"PemberitahuanController"}}}).state("app.pinjaman",{url:"/pinjaman",views:{content:{templateUrl:"templates/pinjaman.html",controller:"PinjamanController"}}}).state("app.favorit",{url:"/favorit",views:{content:{templateUrl:"templates/favorit.html",controller:"FavoritController"}}}).state("app.send_feedback",{url:"/send-feedback",views:{content:{templateUrl:"templates/send-feedback.html",controller:"SendFeedbackController"}}}).state("app.pengaturan",{url:"/pengaturan",views:{content:{templateUrl:"templates/pengaturan.html",controller:"PengaturanController"}}}).state("login",{url:"/login",templateUrl:"templates/login.html",controller:"LoginController"}).state("register",{url:"/register",templateUrl:"templates/login-register.html",controller:"RegisterController"}),o.otherwise("/app/koleksi")}]);var controll=angular.module("controllers",[]);controll.run(["$ionicPlatform","$ionicHistory","$rootScope","user","$location",function(e,o,t,n,r){n.isLoginLocal()||r.path("/login")}]),controll.controller("IndexController",["$scope","$state","$ionicHistory","$location","$ionicSideMenuDelegate","user","$ionicPopover",function(e,o,t,n,r,i,a){console.info("IndexController"),e.$on("$ionicView.enter",function(e,o){}),e.$on("$ionicView.leave",function(e,o){}),e.isBackButtonShow=function(){return null!==t.backView()},e.changeState=function(e){r.isOpenLeft()&&r.toggleLeft(),o.go(e)},e.getColor=function(e){e=e||0;var o=["#F44336","#E91E63","#9C27B0","#673AB7","#3F51B5","#2196F3","#E65100","#33691E","#827717","#006064","#01579B","#009688","#424242"];return e>=o.length&&(e%=o.length),o[e]},e.getBookThumbnail=function(e){return"http://localhost/perpus/lib/phpthumb/phpThumb.php?src=../../images/docs/"+e+"&w=100"},e.getMemberAvatar=function(e){return e?e:"img/default-user-image.png"},e.reviews=[{name:"Afief Yona R",date:"10 Oktober 2015",content:"Proin euismod sapien quis libero luctus elementum. Mauris semper ullamcorper porta. Integer aliquam ullamcorper ante vel convallis. Fusce nec lacus quis mi accumsan lobortis. Aliquam erat volutpat. Nunc condimentum pharetra accumsan. Suspendisse pharetra convallis dui, eu faucibus eros rhoncus nec.",like:!1,thumbnail:"img/afief.jpg"},{name:"Rizky Djati M",date:"9 Agustus 2015",content:"Proin euismod sapien quis libero luctus elementum. Mauris semper ullamcorper porta. Integer aliquam ullamcorper ante vel convallis. Fusce nec lacus quis mi accumsan lobortis. Aliquam erat volutpat. Nunc condimentum pharetra accumsan. Suspendisse pharetra convallis dui, eu faucibus eros rhoncus nec.",like:!0,thumbnail:"img/djati.jpg"},{name:"Henida W",date:"6 Agustus 2015",content:"Proin euismod sapien quis libero luctus elementum. Mauris semper ullamcorper porta. Integer aliquam ullamcorper ante vel convallis. Fusce nec lacus quis mi accumsan lobortis. Aliquam erat volutpat. Nunc condimentum pharetra accumsan. Suspendisse pharetra convallis dui, eu faucibus eros rhoncus nec.",like:!1,thumbnail:"img/nurul.jpg"}],e.borroweds=[{title:"The Forever War",author:"Joe Haldeman",thumbnail:"img/books/book5.jpg",pages_count:300,isbn:"9785412654856",year:2e3,date_borrow:"15 September 2015",date_return:"10 Oktober 2015"},{title:"Ender's Game",author:"Orson Scott",thumbnail:"img/books/book6.jpg",pages_count:210,isbn:"9785412654856",year:2010,date_borrow:"12 September 2015",date_return:"13 Oktober 2015"},{title:"Merajut Untaian Rindu",author:"Alibaba Everest",thumbnail:"img/books/book1.jpg",pages_count:250,isbn:"9788935487965",year:2015,date_borrow:"10 September 2015",date_return:"7 Oktober 2015"}],a.fromTemplateUrl("menu-pop.html",{scope:e}).then(function(o){e.popTopRight=o}),e.showRightMenu=function(o){e.popTopRight.show(o)},e.$on("$destroy",function(){e.popTopRight.remove()}),e.doViewRefresh=function(){e.popTopRight.hide(),e.$broadcast("refresh")},e.doViewHelp=function(){e.popTopRight.hide()}}]),controll.controller("BukuController",["$scope","$state","$ionicHistory","user","$ionicLoading",function(e,o,t,n,r){function i(o){e.book=o,o.is_fav&&(e.isFavorit=!0)}console.info("Buku Controller"),e.id=o.params.id,e.book=!1,e.isFavorit=!1,r.show({template:"Mengambil Data Buku"}),n.getBook(e.id).then(function(e){i(e),r.hide()},function(e){r.hide(),console.log(e)}),e.toggleFav=function(){e.isFavorit?(e.isFavorit=!1,n.unsetBookFav(e.id)):(e.isFavorit=!0,n.setBookFav(e.id))}}]),controll.controller("BukuReviewController",["$scope","$state","$ionicHistory","user","$ionicLoading","$ionicPopup",function(e,o,t,n,r,i){function a(o){e.book=o,o.own_rate?e.rating=o.own_rate:e.rating=0,n.getBookComments(e.id).then(function(o){e.comments=o})}console.info("Buku Controller"),e.id=o.params.id,e.book=!1,e.rating=0,e.comments=[],e.input={comment:""},r.show({template:"Mengambil Data Buku"}),n.getBook(e.id).then(function(e){a(e),r.hide()},function(e){r.hide(),console.log(e)}),e.setRating=function(o){e.rating=o,n.setBookRate(e.id,o).then(function(e){console.log("Set Rate Success")})},e.doSendComment=function(){e.input.comment||i.alert({title:"Data tidak lengkap",template:"Kolom komentar harus diisi."}),n.setBookComments(e.id,e.input.comment).then(function(o){e.comments.unshift(o),e.input.comment=""},function(e){"string"==typeof e&&i.alert({title:"Gagal mengirim komentar",template:e})})}}]),controll.controller("FavoritController",["$scope","$state","$ionicHistory","$ionicLoading","user",function(e,o,t,n,r){console.info("FavoritController");var i=0,a=10,s={offset:i,limit:a,favorit:1};e.books=[],e.total=0,e.search={text:""},e.openBook=function(e){o.go("app.buku",{id:e})},t.clearHistory(),e.doRefresh=function(o){n.show({template:"Mengambil Buku"}),r.getBooks(s).then(function(t){o?e.books=t.results:e.books=e.books.concat(t.results),e.total=t.params.total,n.hide()},function(){n.hide()})},e.doRefresh(),e.doLoadMore=function(){i+=a,s.limit=a,s.offset=i,e.doRefresh()},e.canLoadMore=function(){return i+a<e.total},e.doSearch=function(){i=0,a=10,s={offset:i,limit:a,title:e.search.text},e.doRefresh(!0)},e.doReset=function(){i=0,a=10,s={offset:i,limit:a,favorit:1},e.doRefresh(!0)},e.$on("$ionicView.enter",function(){e.doReset()}),e.$on("refresh",function(){e.doReset()})}]),controll.controller("SendFeedbackController",["$scope","$state","$ionicHistory","user",function(e,o,t,n){console.info("SendFeedbackController"),t.clearHistory()}]),controll.controller("KoleksiController",["$scope","$state","$ionicHistory","$ionicLoading","user",function(e,o,t,n,r){console.info("Koleksi Controller");var i=0,a=10,s={offset:i,limit:a};e.books=[],e.total=0,e.search={text:""},e.openBook=function(e){o.go("app.buku",{id:e})},t.clearHistory(),e.doRefresh=function(o){n.show({template:"Mengambil Buku"}),r.getBooks(s).then(function(t){o?e.books=t.results:e.books=e.books.concat(t.results),e.total=t.params.total,n.hide()},function(){n.hide()})},e.doRefresh(),e.doLoadMore=function(){i+=a,s.limit=a,s.offset=i,e.doRefresh()},e.canLoadMore=function(){return i+a<e.total},e.doSearch=function(){i=0,a=10,s={offset:i,limit:a,title:e.search.text},e.doRefresh(!0)},e.$on("refresh",function(){i=0,a=10,s={offset:i,limit:a},e.doRefresh(!0)})}]),controll.controller("LoginController",["$scope","$location","$ionicHistory","user","$ionicPopup","$ionicLoading",function(e,o,t,n,r,i){console.info("LoginController"),t.clearHistory(),e.data={username:"",password:""},e.doLogin=function(){console.log("login",e.data.username),""===e.data.username?r.alert({template:"Username / Email tidak boleh kosong.",title:"Data Tidak Lengkap"}):""===e.data.password?r.alert({template:"Password tidak boleh kosong.",title:"Data Tidak Lengkap"}):(i.show({template:"Memproses Login"}),n.login(e.data.username,e.data.password).then(function(e){o.path("/app/koleksi"),i.hide()},function(e){i.hide(),r.alert({template:e,title:"Gagal"})}))},e.openRegister=function(){o.path("register")}}]),controll.controller("RegisterController",["$scope","$location","$ionicHistory","user","$ionicPopup","$ionicLoading",function(e,o,t,n,r,i){console.log("RegisterController"),e.data={member_id:"",member_name:"",email:"",member_phone:"",password:""},e.openLogin=function(){o.path("login")},e.doRegister=function(){var t=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;!e.data.member_id||e.data.member_id.length<5?r.alert({template:"Member ID tidak boleh kosong. Minimal 5 Karakter.",title:"Data Tidak Lengkap"}):!e.data.member_name||e.data.member_name.length<5?r.alert({template:"Nama Lengkap tidak boleh kosong. Minimal 5 Karakter.",title:"Data Tidak Lengkap"}):e.data.email?t.test(e.data.email)?!e.data.member_phone&&e.data.member_phone.length<5?r.alert({template:"Nomor HP tidak boleh kosong.",title:"Data Tidak Lengkap"}):!e.data.password||e.data.password.length<6||e.data.password!=e.data.password2?r.alert({template:"Password tidak boleh kosong dan minimal mengandung 6 karakter. Kedua password harus sama.",title:"Data Tidak Lengkap"}):(i.show({template:"Memproses Registrasi"}),n.register(e.data).then(function(){o.path("/app/koleksi"),i.hide()},function(e){i.hide(),i.hide(),r.alert({template:e,title:"Gagal"})})):r.alert({template:"Format Email tidak benar.",title:"Data Tidak Lengkap"}):r.alert({template:"Email tidak boleh kosong.",title:"Data Tidak Lengkap"})}}]),controll.controller("PemberitahuanController",["$scope","$state","$ionicHistory","user","$ionicLoading",function(e,o,t,n,r){function i(){for(var o=[],t=0;t<e.notifs.data.length;t++)"0"==e.notifs.data[t].is_read&&o.push(e.notifs.data[t].id);o.length&&n.postNotifRead(o).then(function(e){console.log("Notif Read",e)},function(){})}console.info("PemberitahuanController"),t.clearHistory(),e.notifs=[],e.doRefresh=function(){r.show({template:"Mengambil Data Notifikasi"}),n.getNotif().then(function(o){e.notifs=o,i(),r.hide()},function(){r.hide()})},e.$on("refresh",function(){e.doRefresh()}),e.doRefresh()}]),controll.controller("PengaturanController",["$scope","$state","$location","$ionicHistory","user",function(e,o,t,n,r){console.info("PengaturanController"),n.clearHistory(),e.doLogout=function(){t.path("/login")}}]),controll.controller("PesanController",["$scope","$state","$ionicHistory","user","$ionicLoading","$ionicPopup",function(e,o,t,n,r,i){console.info("PesanController"),t.clearHistory(),e.messages=[],e.doRefresh=function(){r.show({template:"Mengambil Daftar Pesan"}),n.getMessageList().then(function(o){e.messages=o,r.hide()},function(){r.hide()})},e.$on("refresh",function(){e.doRefresh()}),e.doRefresh(),e.newMessage=function(){e.input={member_id:"",text:""};var o=i.show({title:"Kirim Pesan",cssClass:"new-message",templateUrl:"templates/popup-newmessage.html",scope:e,buttons:[{text:"Batal",type:"button-default"},{text:"Kirim",type:"button-positive",onTap:function(t){t.preventDefault(),r.show({template:"Mengirim Pesan"}),n.postMessage(e.input.member_id,e.input.text).then(function(){r.hide(),o.close(),e.doRefresh()},function(e){r.hide(),"string"==typeof e&&alert(e)})}}]})}}]),controll.controller("PinjamanController",["$scope","$state","$ionicHistory","user",function(e,o,t,n){console.info("PinjamanController"),e.books=[],e.doRefresh=function(){n.getBookLoans().then(function(o){console.log(o),e.books=o})},e.doRefresh(),e.$on("refresh",function(){e.doRefresh()})}]),controll.controller("ProfilController",["$scope","$state","$ionicHistory","user","$ionicLoading",function(e,o,t,n,r){console.info("ProfilController"),t.clearHistory(),e.edit={member_name:n.profile.member_name,member_phone:n.profile.member_phone,member_address:n.profile.member_address},e.isEditPhone=!1,e.editPhone=function(){e.isEditPhone||(e.edit.member_phone=n.profile.member_phone,e.isEditPhone=!0)},e.isEditAddress=!1,e.editAddress=function(){e.isEditAddress||(e.edit.member_address=n.profile.member_address,e.isEditAddress=!0)},e.isEditName=!1,e.editName=function(){e.isEditName||(e.edit.member_name=n.profile.member_name,e.isEditName=!0)},e.saveBio=function(){r.show({template:"Menyimpan Biodata"}),n.saveBio(e.edit).then(function(){n.profile.member_phone=e.edit.member_phone,n.profile.member_address=e.edit.member_address,n.profile.member_name=e.edit.member_name,e.isEditPhone=!1,e.isEditAddress=!1,e.isEditName=!1,r.hide()},function(){r.hide()})}}]);
//# sourceMappingURL=digilib.min.js.map
