var lg=console.log.bind(console),lgi=console.log.bind(console),lge=console.log.bind(console),lgw=console.log.bind(console),app_version=2,app_version_text="0.1.2",apiUrl="http://localhost/perpus/api/";String.prototype.toTitleCase=function(){return this.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})};var settingModule=angular.module("SettingModule",[]);settingModule.factory("setting",["$rootScope","$q",function(e,t){return{set:function(e,t){return window.localStorage?("object"==typeof t&&(t=JSON.stringify(t)),window.localStorage[e]=t,!0):!1},get:function(e){if(window.localStorage){var t=window.localStorage[e];if(t)try{var o=JSON.parse(t);return o}catch(n){if("undefined"==t)return;return"false"==t?!1:t}if("undefined"==t)return;return"false"==t?!1:t}return!1},resolveOnlineImage:function(e){if(window.resolveLocalFileSystemURL){var o=t.defer(),n=e.split("/").lastValue;if(!n)return t.when(e);try{window.resolveLocalFileSystemURL(cordova.file.applicationStorageDirectory+n,function(e){console.log("get local image : "+cordova.file.applicationStorageDirectory+n);var t=e.toURL();o.resolve(t)},function(){if(FileTransfer){var t=new FileTransfer;t.download(e,cordova.file.applicationStorageDirectory+n,function(e){console.log("save online image : "+cordova.file.applicationStorageDirectory+n);var t=e.toURL();o.resolve(t)},function(t){console.log("failed save online image"),o.resolve(e)},!0,{})}else console.log("FileTransfer not supported"),o.resolve(e)})}catch(i){return t.when(e)}return o.promise}return console.log("resolveLocalFileSystemURL not supported"),t.when(e)}}}]),settingModule.run(["$rootScope","setting",function(e,t){e.setting=t}]);var userModule=angular.module("UserModule",[],["$httpProvider",function(e){e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded"}]);userModule.factory("user",["$http","$q","$rootScope","Upload","setting",function(e,t,o,n,i){function r(t){l=t,e.defaults.headers.common.token=l,window.localStorage["digilib-upi"]=l,console.log("change key",l)}function a(o,n){var i=t.defer();o+=o.indexOf("?")>=0?"&buzzdata="+(new Date).getTime().toString():"?buzzdata="+(new Date).getTime().toString();e.get(apiUrl+o).success(function(e){e.status?i.resolve(e.data):i.reject(e.message)})["catch"](function(e){i.reject(e)});return i.promise}function s(o,n){var i=t.defer();o+=o.indexOf("?")>=0?"&buzzdata="+(new Date).getTime().toString():"?buzzdata="+(new Date).getTime().toString();e.post(apiUrl+o,serialize(n)).success(function(e){e.status?i.resolve(e.data):i.reject(e.message)})["catch"](function(e){i.reject(e)});return i.promise}window.f=e;var l=window.localStorage["digilib-upi"]||"",c=!1,u=i.get("profile")||{};return e.defaults.headers.common.token=l,serialize=function(e,t){var o=[];for(var n in e)if(e.hasOwnProperty(n)){var i=t?t+"["+n+"]":n,r=e[n];o.push("object"==typeof r?serialize(r,i):encodeURIComponent(i)+"="+encodeURIComponent(r))}return o.join("&")},{get profile(){return u},set profile(e){u=e},getKey:function(){return l},setKey:function(e){r(e),e&&(c=!0),this.cek()},isLogin:function(){return lgi("isLogin",c),c},isLoginLocal:function(){return""!==l},login:function(o,n){var i=t.defer(),a=this,s={email:o,password:n};return e.post(apiUrl+"auth/login",serialize(s)).success(function(e){e.status?e.data&&e.data.token?(r(e.data.token),c=!0,a.cek(),i.resolve(!0)):i.reject("Gagal mengambil token login."):e.message&&"string"==typeof e.detail?i.reject(e.detail):i.reject("Username / Password salah")})["catch"](function(e){i.reject(e)}),i.promise},register:function(o){var n=t.defer(),i=this;return e.post(apiUrl+"auth/register",serialize(o)).success(function(e){e.status?e.data&&e.data.token?(r(e.data.token),c=!0,i.cek(),n.resolve(!0)):n.reject("Gagal mengambil token login."):e.message&&"string"==typeof e.message?n.reject(e.message):n.reject("Username / Password salah")})["catch"](function(e){n.reject(e)}),n.promise},changeAvatar:function(e){var o=t.defer();return n.upload({url:apiUrl+"user/avatar",method:"POST",file:e,sendFieldsAs:"form",fields:{}}).progress(function(e){var t=parseInt(100*e.loaded/e.total);o.notify(t)}).success(function(e,t,n,i){console.log(e),e.status?o.resolve(e.data):o.reject(!1)}).error(function(e,t,n,i){console.log(e),o.reject(!1)}),o.promise},cekLocal:function(){return lgi("cek local",l),""===l?t.when({status:!1}):t.when({status:!0})},cek:function(){var n=t.defer(),a=this;return""===l?t.when({status:!1}):(e.get(apiUrl+"user").success(function(e,t){lgi("cek login",e.status,e.data),e.status?(c=!0,a.profile=e.data,a.profile.member_image?i.resolveOnlineImage(a.profile.member_image).then(function(e){a.profile.member_image=e}):a.profile.member_image="img/default-user-image.png",i.set("profile",a.profile),n.resolve(e.data),o.$broadcast("onuser",a.profile)):e.hasOwnProperty("status")?(r(""),n.resolve(e)):e.hasOwnProperty("message")?n.reject(e.message):n.reject(JSON.stringify(e))})["catch"](function(e){n.reject(JSON.stringify(e))}),n.promise)},changeKey:r,logout:function(){var o=t.defer();e.get(apiUrl+"logout").success(function(e){c=!1,r(""),o.resolve(!0)})["catch"](function(e){c=!1,r(""),o.resolve(!0)});return o.promise},saveBio:function(e){return s("user",e)},getBooks:function(e){var t="";return e&&(t="?"+serialize(e)),a("books"+t)},getBook:function(e){return a("book/"+e)},getBookRate:function(e){return a("book/"+e+"/rate")},setBookRate:function(e,t){return s("book/"+e+"/rate",{rate:t})},getBookComments:function(e){return a("book/"+e+"/comments")},setBookComments:function(e,t){return s("book/"+e+"/comment",{text:t})},setBookFav:function(e){return s("book/"+e+"/favorit")},unsetBookFav:function(e){return s("book/"+e+"/unfavorit")},getBookLoans:function(){return a("user/books")},getMessageList:function(){return a("messages")},getMessageTexts:function(e){return a("message/"+e)},postMessage:function(e,t){return s("message",{member_id:e,text:t})},getTopics:function(){return a("books/topics")},getNotif:function(){return a("notif")},postNotifRead:function(e){return s("notif/read",{notif_id:e})},getVersion:function(e){return a("check-version/"+e)}}}]),userModule.run(["user","$rootScope","$http","$ionicPlatform","$location",function(e,t,o,n,i){n.ready(function(){console.log("Ionic Ready"),t.user=e,e.cek().then(function(){},function(){i.path("/login")})})}]);var mainApp=angular.module("digilib",["ionic","controllers","UserModule","SettingModule","ngFileUpload"]);mainApp.run(["$ionicConfig","$ionicPlatform","$ionicHistory","$rootScope","user","$ionicPopup",function(e,t,o,n,i,r){i.getVersion(app_version).then(function(e){r.alert({title:e.title,template:e.text}).then(function(){window.open(e.gplay,"_system")})}),n.version_text=app_version_text,t.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()}),screen.lockOrientation&&screen.lockOrientation("portrait")}]),mainApp.config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider",function(e,t,o){o.tabs.style("standard").position("bottom"),o.navBar.alignTitle("center").positionPrimaryButtons("left"),e.state("app",{url:"/app","abstract":!0,templateUrl:"templates/index.html",controller:"IndexController"}).state("app.koleksi",{url:"/koleksi",views:{historyRoot:!0,content:{templateUrl:"templates/koleksi.html",controller:"KoleksiController"}}}).state("app.profil",{url:"/profil",views:{content:{templateUrl:"templates/profil.html",controller:"ProfilController"}}}).state("app.buku",{url:"/buku/:id",views:{content:{templateUrl:"templates/buku.html",controller:"BukuController"}}}).state("app.buku-review",{url:"/buku/:id/review",views:{content:{templateUrl:"templates/buku-review.html",controller:"BukuReviewController"}}}).state("app.pesan",{url:"/pesan",views:{content:{templateUrl:"templates/pesan.html",controller:"PesanController"}}}).state("app.pesan-single",{url:"/pesan-single/:member_id",views:{content:{templateUrl:"templates/pesan-single.html",controller:"PesanSingleController"}}}).state("app.pemberitahuan",{url:"/pemberitahuan",views:{content:{templateUrl:"templates/pemberitahuan.html",controller:"PemberitahuanController"}}}).state("app.pinjaman",{url:"/pinjaman",views:{content:{templateUrl:"templates/pinjaman.html",controller:"PinjamanController"}}}).state("app.favorit",{url:"/favorit",views:{content:{templateUrl:"templates/favorit.html",controller:"FavoritController"}}}).state("app.send_feedback",{url:"/send-feedback",views:{content:{templateUrl:"templates/send-feedback.html",controller:"SendFeedbackController"}}}).state("app.pengaturan",{url:"/pengaturan",views:{content:{templateUrl:"templates/pengaturan.html",controller:"PengaturanController"}}}).state("login",{url:"/login",templateUrl:"templates/login.html",controller:"LoginController"}).state("register",{url:"/register",templateUrl:"templates/login-register.html",controller:"RegisterController"}),t.otherwise("/app/koleksi")}]);var controll=angular.module("controllers",[]);controll.run(["$ionicPlatform","$ionicHistory","$rootScope","user","$location",function(e,t,o,n,i){n.isLoginLocal()||i.path("/login")}]),controll.controller("IndexController",["$scope","$state","$ionicHistory","$location","$ionicSideMenuDelegate","user","$ionicPopover",function(e,t,o,n,i,r,a){console.info("IndexController"),e.$on("$ionicView.enter",function(e,t){}),e.$on("$ionicView.leave",function(e,t){}),e.isBackButtonShow=function(){return null!==o.backView()},e.changeState=function(e){i.isOpenLeft()&&i.toggleLeft(),t.go(e)},e.getColor=function(e){e=e||0;var t=["#F44336","#E91E63","#9C27B0","#673AB7","#3F51B5","#2196F3","#E65100","#33691E","#827717","#006064","#01579B","#009688","#424242"];return e>=t.length&&(e%=t.length),t[e]},e.getBookThumbnail=function(e){return e?e:""},e.getMemberAvatar=function(e){return e?e:"img/default-user-image.png"},a.fromTemplateUrl("menu-pop.html",{scope:e}).then(function(t){e.popTopRight=t}),e.showRightMenu=function(t){e.popTopRight.show(t)},e.$on("$destroy",function(){e.popTopRight.remove()}),e.doViewRefresh=function(){e.popTopRight.hide(),e.$broadcast("refresh")},e.doViewHelp=function(){e.popTopRight.hide()}}]),controll.controller("BukuController",["$scope","$state","$ionicHistory","user","$ionicLoading",function(e,t,o,n,i){function r(t){e.book=t,t.is_fav&&(e.isFavorit=!0)}console.info("Buku Controller"),e.id=t.params.id,e.book=!1,e.isFavorit=!1,i.show({template:"Mengambil Data Buku"}),n.getBook(e.id).then(function(e){r(e),i.hide()},function(e){i.hide(),console.log(e)}),e.toggleFav=function(){e.isFavorit?(e.isFavorit=!1,n.unsetBookFav(e.id)):(e.isFavorit=!0,n.setBookFav(e.id))}}]),controll.controller("BukuReviewController",["$scope","$state","$ionicHistory","user","$ionicLoading","$ionicPopup",function(e,t,o,n,i,r){function a(t){e.book=t,t.own_rate?e.rating=t.own_rate:e.rating=0,n.getBookComments(e.id).then(function(t){e.comments=t})}console.info("Buku Controller"),e.id=t.params.id,e.book=!1,e.rating=0,e.comments=[],e.input={comment:""},i.show({template:"Mengambil Data Buku"}),n.getBook(e.id).then(function(e){a(e),i.hide()},function(e){i.hide(),console.log(e)}),e.setRating=function(t){e.rating=t,n.setBookRate(e.id,t).then(function(e){console.log("Set Rate Success")})},e.doSendComment=function(){e.input.comment||r.alert({title:"Data tidak lengkap",template:"Kolom komentar harus diisi."}),n.setBookComments(e.id,e.input.comment).then(function(t){e.comments.unshift(t),e.input.comment=""},function(e){"string"==typeof e&&r.alert({title:"Gagal mengirim komentar",template:e})})}}]),controll.controller("FavoritController",["$scope","$state","$ionicHistory","$ionicLoading","user",function(e,t,o,n,i){console.info("FavoritController");var r=0,a=10,s={offset:r,limit:a,favorit:1};e.books=[],e.total=0,e.search={text:""},e.openBook=function(e){t.go("app.buku",{id:e})},o.clearHistory(),e.doRefresh=function(t){n.show({template:"Mengambil Buku"}),i.getBooks(s).then(function(o){t?e.books=o.results:e.books=e.books.concat(o.results),e.total=o.params.total,n.hide()},function(){n.hide()})},e.doRefresh(),e.doLoadMore=function(){r+=a,s.limit=a,s.offset=r,e.doRefresh()},e.canLoadMore=function(){return r+a<e.total},e.doSearch=function(){r=0,a=10,s={offset:r,limit:a,title:e.search.text},e.doRefresh(!0)},e.doReset=function(){r=0,a=10,s={offset:r,limit:a,favorit:1},e.doRefresh(!0)},e.$on("$ionicView.enter",function(){e.doReset()}),e.$on("refresh",function(){e.doReset()})}]),controll.controller("SendFeedbackController",["$scope","$state","$ionicHistory","user",function(e,t,o,n){console.info("SendFeedbackController"),o.clearHistory()}]),controll.controller("KoleksiController",["$scope","$state","$ionicHistory","$ionicLoading","user",function(e,t,o,n,i){console.info("Koleksi Controller");var r=0,a=10,s={offset:r,limit:a};e.sectionTitle="",e.books=[],e.total=0,e.search={text:""},e.topics=[],i.getTopics().then(function(t){e.topics=t}),e.openBook=function(e){t.go("app.buku",{id:e})},o.clearHistory(),e.doRefresh=function(t){n.show({template:"Mengambil Buku"}),i.getBooks(s).then(function(o){t?e.books=o.results:e.books=e.books.concat(o.results),e.total=o.params.total,o.params&&o.params.topic_name?e.sectionTitle="Kategori : "+o.params.topic_name.toTitleCase():o.params&&o.params.title?e.sectionTitle="Pencarian : "+o.params.title.toTitleCase():e.sectionTitle=!1,n.hide()},function(){n.hide()})},e.doRefresh(),e.doLoadMore=function(){r+=a,s.limit=a,s.offset=r,e.doRefresh()},e.canLoadMore=function(){return r+a<e.total},e.doSearch=function(){r=0,a=10,s={offset:r,limit:a,title:e.search.text},e.doRefresh(!0)},e.doOpenTopic=function(t){r=0,a=10,s={offset:r,limit:a,topic:t},e.doRefresh(!0)},e.doReset=function(){r=0,a=10,s={offset:r,limit:a},e.doRefresh(!0)},e.$on("refresh",function(){e.doReset()}),e.getBG=function(e){var t=["#daedf2","#a5f7b3","#f7f1a5","#f7a5a5","#c9bbf3","#f3bbe2"];return t[e%t.length]}}]),controll.controller("LoginController",["$scope","$location","$ionicHistory","user","$ionicPopup","$ionicLoading",function(e,t,o,n,i,r){console.info("LoginController"),o.clearHistory(),e.data={username:"",password:""},e.doLogin=function(){console.log("login",e.data.username),""===e.data.username?i.alert({template:"Username / Email tidak boleh kosong.",title:"Data Tidak Lengkap"}):""===e.data.password?i.alert({template:"Password tidak boleh kosong.",title:"Data Tidak Lengkap"}):(r.show({template:"Memproses Login"}),n.login(e.data.username,e.data.password).then(function(e){t.path("/app/koleksi"),r.hide()},function(e){r.hide(),i.alert({template:e,title:"Gagal"})}))},e.openRegister=function(){t.path("register")}}]),controll.controller("RegisterController",["$scope","$location","$ionicHistory","user","$ionicPopup","$ionicLoading",function(e,t,o,n,i,r){console.log("RegisterController"),e.data={member_id:"",member_name:"",email:"",member_phone:"",password:""},e.openLogin=function(){t.path("login")},e.doRegister=function(){var o=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;!e.data.member_id||e.data.member_id.length<5?i.alert({template:"Member ID tidak boleh kosong. Minimal 5 Karakter.",title:"Data Tidak Lengkap"}):!e.data.member_name||e.data.member_name.length<5?i.alert({template:"Nama Lengkap tidak boleh kosong. Minimal 5 Karakter.",title:"Data Tidak Lengkap"}):e.data.email?o.test(e.data.email)?!e.data.member_phone&&e.data.member_phone.length<5?i.alert({template:"Nomor HP tidak boleh kosong.",title:"Data Tidak Lengkap"}):!e.data.password||e.data.password.length<6||e.data.password!=e.data.password2?i.alert({template:"Password tidak boleh kosong dan minimal mengandung 6 karakter. Kedua password harus sama.",title:"Data Tidak Lengkap"}):(r.show({template:"Memproses Registrasi"}),n.register(e.data).then(function(){t.path("/app/koleksi"),r.hide()},function(e){r.hide(),r.hide(),i.alert({template:e,title:"Gagal"})})):i.alert({template:"Format Email tidak benar.",title:"Data Tidak Lengkap"}):i.alert({template:"Email tidak boleh kosong.",title:"Data Tidak Lengkap"})}}]),controll.controller("PemberitahuanController",["$scope","$state","$ionicHistory","user","$ionicLoading",function(e,t,o,n,i){function r(){for(var t=[],o=0;o<e.notifs.data.length;o++)"0"===e.notifs.data[o].is_read&&t.push(e.notifs.data[o].id);t.length&&n.postNotifRead(t).then(function(e){console.log("Notif Read",e)},function(){})}console.info("PemberitahuanController"),o.clearHistory(),e.notifs=[],e.doRefresh=function(){i.show({template:"Mengambil Data Notifikasi"}),n.getNotif().then(function(t){e.notifs=t,r(),i.hide()},function(){i.hide()})},e.$on("refresh",function(){e.doRefresh()}),e.doRefresh(),e.doOpen=function(e){0===e.text.indexOf("mengirim pesan")&&t.go("app.pesan-single",{member_id:e.from_id})}}]),controll.controller("PengaturanController",["$scope","$state","$location","$ionicHistory","user",function(e,t,o,n,i){console.info("PengaturanController"),n.clearHistory(),e.doLogout=function(){o.path("/login")}}]),controll.controller("PesanSingleController",["$scope","$state","user","$ionicLoading","$ionicPopup","$stateParams","$ionicScrollDelegate",function(e,t,o,n,i,r,a){console.info("PesanController");var s=a.$getByHandle("chatScroll");r.member_id||t.go("app.pesan"),e.member_id=r.member_id,e.text="",e.messages=[],e.doRefresh=function(){n.show({template:"Mengambil Pesan"}),o.getMessageTexts(r.member_id).then(function(t){e.messages=t,s.scrollBottom(),n.hide()},function(){n.hide()})},e.doRefresh(),e.sendMessage=function(){n.show({template:"Mengirim Pesan"}),o.postMessage(r.member_id,e.text).then(function(){n.hide(),e.text="",e.doRefresh()},function(){n.hide()})},e.$on("refresh",function(){e.doRefresh()})}]),controll.controller("PesanController",["$scope","$state","$ionicHistory","user","$ionicLoading","$ionicPopup",function(e,t,o,n,i,r){console.info("PesanController"),o.clearHistory(),e.messages=[],e.doRefresh=function(){i.show({template:"Mengambil Daftar Pesan"}),n.getMessageList().then(function(t){e.messages=t,i.hide()},function(){i.hide()})},e.$on("refresh",function(){e.doRefresh()}),e.doRefresh(),e.newMessage=function(){e.input={member_id:"",text:""};var t=r.show({title:"Kirim Pesan",cssClass:"new-message",templateUrl:"templates/popup-newmessage.html",scope:e,buttons:[{text:"Batal",type:"button-default"},{text:"Kirim",type:"button-positive",onTap:function(o){o.preventDefault(),i.show({template:"Mengirim Pesan"}),n.postMessage(e.input.member_id,e.input.text).then(function(){i.hide(),t.close(),e.doRefresh()},function(e){i.hide(),"string"==typeof e&&alert(e)})}}]})},e.openChat=function(e){t.go("app.pesan-single",{member_id:e})}}]),controll.controller("PinjamanController",["$scope","$state","$ionicHistory","user",function(e,t,o,n){console.info("PinjamanController"),e.books=[],e.doRefresh=function(){n.getBookLoans().then(function(t){console.log(t),e.books=t})},e.doRefresh(),e.$on("refresh",function(){e.doRefresh()})}]),controll.controller("ProfilController",["$scope","$state","$ionicHistory","user","$ionicLoading",function(e,t,o,n,i){console.info("ProfilController"),o.clearHistory(),e.edit={member_name:n.profile.member_name,member_phone:n.profile.member_phone,member_address:n.profile.member_address},e.isEditPhone=!1,e.editPhone=function(){e.isEditPhone||(e.edit.member_phone=n.profile.member_phone,e.isEditPhone=!0)},e.isEditAddress=!1,e.editAddress=function(){e.isEditAddress||(e.edit.member_address=n.profile.member_address,e.isEditAddress=!0)},e.isEditName=!1,e.editName=function(){e.isEditName||(e.edit.member_name=n.profile.member_name,e.isEditName=!0)},e.saveBio=function(){i.show({template:"Menyimpan Biodata"}),n.saveBio(e.edit).then(function(){n.profile.member_phone=e.edit.member_phone,n.profile.member_address=e.edit.member_address,n.profile.member_name=e.edit.member_name,e.isEditPhone=!1,e.isEditAddress=!1,e.isEditName=!1,i.hide()},function(){i.hide()})},e.doChangeAvatar=function(){document.getElementById("userImageEl").click()},e.changeImage=function(t){if(t.files.length>0){var o=t.files[0];i.show({template:"Ganti Profil"}),n.changeAvatar(o).then(function(t){i.hide(),n.profile.member_image=t,e.$$phase||e.$apply()},function(e){i.hide(),"string"==typeof e?$ionicPopup.alert({template:e,title:"Gagal"}):$ionicPopup.alert({template:"Gagal ganti avatar",title:"Gagal"})})}}}]);
//# sourceMappingURL=digilib.min.js.map
