var lg=console.log.bind(console),lgi=console.log.bind(console),lge=console.log.bind(console),lgw=console.log.bind(console),app_version=45,app_version_text="0.4.5",webUrl="http://perpustakaansd.labschool.upi.edu/",apiUrl="http://perpustakaansd.labschool.upi.edu/api/";String.prototype.toTitleCase=function(){return this.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},Number.prototype.toStringZero=function(e){for(var t=this<0,o=Math.abs(this).toString();o.length<e;)o="0"+o;return t&&(o="-"+o),o};var pushModule=angular.module("PushModule",[]);pushModule.factory("pushNotif",["$http","$q","$rootScope",function(e,t,o){var n="";return{get regId(){return n},set regId(e){n=e,o.$broadcast("push-registered")}}}]),pushModule.run(["pushNotif","$rootScope","$ionicPlatform","$location","$timeout",function(e,t,o,n,i){var r="247698159584";o.ready(function(){if(window.hasOwnProperty("PushNotification")){var o=PushNotification.init({android:{senderID:r,forceShow:!1,badge:!0},ios:{alert:"true",badge:!0,sound:"true"},windows:{}});o.on("registration",function(t){e.regId=t.registrationId}),o.on("notification",function(e){if(console.log(e),e.hasOwnProperty("additionalData")){var o=e.additionalData;t.$broadcast("notification",o)}}),o.on("error",function(e){console.log(e.message)})}})}]);var settingModule=angular.module("SettingModule",[]);settingModule.factory("setting",["$rootScope","$q",function(e,t){return{set:function(e,t){return!!window.localStorage&&("object"==typeof t&&(t=JSON.stringify(t)),window.localStorage[e]=t,!0)},get:function(e){if(window.localStorage){var t=window.localStorage[e];if(t)try{var o=JSON.parse(t);return o}catch(n){if("undefined"==t)return;return"false"!=t&&t}if("undefined"==t)return;return"false"!=t&&t}return!1},resolveOnlineImage:function(e){if(window.resolveLocalFileSystemURL){var o=t.defer(),n=e.split("/").lastValue;if(!n)return t.when(e);try{window.resolveLocalFileSystemURL(cordova.file.applicationStorageDirectory+n,function(e){console.log("get local image : "+cordova.file.applicationStorageDirectory+n);var t=e.toURL();o.resolve(t)},function(){if(FileTransfer){var t=new FileTransfer;t.download(e,cordova.file.applicationStorageDirectory+n,function(e){console.log("save online image : "+cordova.file.applicationStorageDirectory+n);var t=e.toURL();o.resolve(t)},function(t){console.log("failed save online image"),o.resolve(e)},!0,{})}else console.log("FileTransfer not supported"),o.resolve(e)})}catch(i){return t.when(e)}return o.promise}return console.log("resolveLocalFileSystemURL not supported"),t.when(e)}}}]),settingModule.run(["$rootScope","setting",function(e,t){e.setting=t}]);var userModule=angular.module("UserModule",[],["$httpProvider",function(e){e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded"}]);userModule.factory("user",["$http","$q","$rootScope","Upload","setting","pushNotif",function(e,t,o,n,i,r){function a(t){c=t,e.defaults.headers.common.token=c,window.localStorage["digilib-upi"]=c,console.log("change key",c)}function s(o,n){var i=t.defer();o+=o.indexOf("?")>=0?"&buzzdata="+(new Date).getTime().toString():"?buzzdata="+(new Date).getTime().toString();e.get(apiUrl+o).success(function(e){e.status?i.resolve(e.data):i.reject(e.message)})["catch"](function(e){i.reject(e)});return i.promise}function l(o,n){var i=t.defer();o+=o.indexOf("?")>=0?"&buzzdata="+(new Date).getTime().toString():"?buzzdata="+(new Date).getTime().toString();e.post(apiUrl+o,serialize(n)).success(function(e){e.status?i.resolve(e.data):i.reject(e.message)})["catch"](function(e){i.reject(e)});return i.promise}window.f=e;var c=window.localStorage["digilib-upi"]||"",u=!1,p=i.get("profile")||{};return e.defaults.headers.common.token=c,serialize=function(e,t){var o=[];for(var n in e)if(e.hasOwnProperty(n)){var i=t?t+"["+n+"]":n,r=e[n];o.push("object"==typeof r?serialize(r,i):encodeURIComponent(i)+"="+encodeURIComponent(r))}return o.join("&")},{get profile(){return p},set profile(e){p=e},getKey:function(){return c},setKey:function(e){a(e),e&&(u=!0),this.cek()},isLogin:function(){return lgi("isLogin",u),u},isLoginLocal:function(){return""!==c},login:function(o,n){var i=t.defer(),s=this,l={email:o,password:n};return e.post(apiUrl+"auth/login",serialize(l)).success(function(e){e.status?e.data&&e.data.token?(a(e.data.token),u=!0,s.cek(),r.regId&&s.updateRegId(r.regId),i.resolve(!0)):i.reject("Gagal mengambil token login."):e.message&&"string"==typeof e.detail?i.reject(e.detail):i.reject("Username / Password salah")})["catch"](function(e){i.reject(e)}),i.promise},register:function(o){var n=t.defer(),i=this;return e.post(apiUrl+"auth/register",serialize(o)).success(function(e){e.status?e.data&&e.data.token?(a(e.data.token),u=!0,i.cek(),r.regId&&i.updateRegId(r.regId),n.resolve(!0)):n.reject("Gagal mengambil token login."):e.message&&"string"==typeof e.message?n.reject(e.message):n.reject("Username / Password salah")})["catch"](function(e){n.reject(e)}),n.promise},changeAvatar:function(e){var o=t.defer();return n.upload({url:apiUrl+"user/avatar",method:"POST",file:e,sendFieldsAs:"form",fields:{}}).progress(function(e){var t=parseInt(100*e.loaded/e.total);o.notify(t)}).success(function(e,t,n,i){console.log(e),e.status?o.resolve(e.data):o.reject(!1)}).error(function(e,t,n,i){console.log(e),o.reject(!1)}),o.promise},cekLocal:function(){return lgi("cek local",c),""===c?t.when({status:!1}):t.when({status:!0})},cek:function(){var n=t.defer(),r=this;return""===c?t.when({status:!1}):(e.get(apiUrl+"user").success(function(e,t){lgi("cek login",e.status,e.data),e.status?(u=!0,r.profile=e.data,r.profile.member_image?i.resolveOnlineImage(r.profile.member_image).then(function(e){r.profile.member_image=e}):r.profile.member_image="img/default-user-image.png",i.set("profile",r.profile),n.resolve(e.data),o.$broadcast("onuser",r.profile)):e.hasOwnProperty("status")&&"forbidden"==e.message?(a(""),n.reject(e)):e.hasOwnProperty("message")?n.reject(e.message):n.reject(JSON.stringify(e))})["catch"](function(e){n.reject(JSON.stringify(e))}),n.promise)},changeKey:a,logout:function(){var o=t.defer();e.get(apiUrl+"logout").success(function(e){u=!1,a(""),o.resolve(!0)})["catch"](function(e){u=!1,a(""),o.resolve(!0)});return o.promise},saveBio:function(e){return l("user",e)},updateUserSetting:function(e){return l("user/setting",e)},getBooks:function(e){var t="";return e&&(t="?"+serialize(e)),s("books"+t)},getBook:function(e){return s("book/"+e)},getBookRate:function(e){return s("book/"+e+"/rate")},setBookRate:function(e,t){return l("book/"+e+"/rate",{rate:t})},getBookComments:function(e){return s("book/"+e+"/comments")},setBookComments:function(e,t){return l("book/"+e+"/comment",{text:t})},setBookFav:function(e){return l("book/"+e+"/favorit")},unsetBookFav:function(e){return l("book/"+e+"/unfavorit")},getBookLoans:function(){return s("user/books")},getBookReserve:function(){return s("books/reserve")},setBookReserve:function(e){return l("books/reserve",{biblio_id:e})},unsetBookReserve:function(e){return l("books/unset-reserve",{biblio_id:e})},getMessageList:function(){return s("messages")},getMessageTexts:function(e){return s("message/"+e)},postMessage:function(e,t){return l("message",{member_id:e,text:t})},getTopics:function(){return s("books/topics")},getNotif:function(){return s("notif")},postNotifRead:function(e){return l("notif/read",{notif_id:e})},getVersion:function(e){return s("check-version/"+e)},getUserByMemberId:function(e){return s("user/id/"+e)},sendReport:function(e){return l("report",{text:e})},updateRegId:function(e){return l("user/reg-id",{reg_id:e})}}}]),userModule.run(["user","$rootScope","$http","$ionicPlatform","$location","pushNotif",function(e,t,o,n,i,r){n.ready(function(){console.log("Ionic Ready"),t.user=e,e.cek().then(function(){},function(){i.path("/login")})}),t.$on("push-registered",function(){console.log("push-registered"),e.isLoginLocal()&&r.regId&&e.updateRegId(r.regId)})}]);var mainApp=angular.module("digilib",["ionic","controllers","UserModule","SettingModule","ngFileUpload","PushModule"]);mainApp.run(["$ionicConfig","$ionicPlatform","$ionicHistory","$rootScope","user","$ionicPopup",function(e,t,o,n,i,r){i.getVersion(app_version).then(function(e){r.alert({title:e.title,template:e.text}).then(function(){window.open(e.gplay,"_system")})}),n.version_text=app_version_text,t.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()}),screen.lockOrientation&&screen.lockOrientation("portrait"),window.cordova&&window.cordova.plugins&&window.cordova.plugins.autoStart&&(alert("autoStart"),cordova.plugins.autoStart.enable()),n.getVersion=function(){return app_version_text}}]),mainApp.config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider",function(e,t,o){o.tabs.style("standard").position("bottom"),o.navBar.alignTitle("center").positionPrimaryButtons("left"),e.state("app",{url:"/app","abstract":!0,templateUrl:"templates/index.html",controller:"IndexController"}).state("app.koleksi",{url:"/koleksi",views:{historyRoot:!0,content:{templateUrl:"templates/koleksi.html",controller:"KoleksiController"}}}).state("app.profil",{url:"/profil",views:{content:{templateUrl:"templates/profil.html",controller:"ProfilController"}}}).state("app.buku",{url:"/buku/:id",views:{content:{templateUrl:"templates/buku.html",controller:"BukuController"}}}).state("app.buku-review",{url:"/buku/:id/review",views:{content:{templateUrl:"templates/buku-review.html",controller:"BukuReviewController"}}}).state("app.pesan",{url:"/pesan",views:{content:{templateUrl:"templates/pesan.html",controller:"PesanController"}}}).state("app.pesan-single",{url:"/pesan-single/:member_id",views:{content:{templateUrl:"templates/pesan-single.html",controller:"PesanSingleController"}}}).state("app.pemberitahuan",{url:"/pemberitahuan",views:{content:{templateUrl:"templates/pemberitahuan.html",controller:"PemberitahuanController"}}}).state("app.pinjaman",{url:"/pinjaman",views:{content:{templateUrl:"templates/pinjaman.html",controller:"PinjamanController"}}}).state("app.reservasi",{url:"/reservasi",views:{content:{templateUrl:"templates/reservasi.html",controller:"ReservasiController"}}}).state("app.favorit",{url:"/favorit",views:{content:{templateUrl:"templates/favorit.html",controller:"FavoritController"}}}).state("app.send_feedback",{url:"/send-feedback",views:{content:{templateUrl:"templates/send-feedback.html",controller:"SendFeedbackController"}}}).state("app.pengaturan",{url:"/pengaturan",views:{content:{templateUrl:"templates/pengaturan.html",controller:"PengaturanController"}}}).state("app.about",{url:"/about",views:{content:{templateUrl:"templates/about.html"}}}).state("app.support",{url:"/support",views:{content:{templateUrl:"templates/support.html",controller:"SupportController"}}}).state("login-home",{url:"/login-home",templateUrl:"templates/login-home.html",controller:"LoginController"}).state("login",{url:"/login",templateUrl:"templates/login.html",controller:"LoginController"}).state("register",{url:"/register",templateUrl:"templates/login-register.html",controller:"RegisterController"}),t.otherwise("/app/koleksi")}]),mainApp.filter("goodate",function(){return function(e){if(e){var t=new Date(e),o=["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agu","Sep","Okt","Nov","Des"],n=t.getDate()+" "+o[t.getMonth()]+" "+t.getFullYear()+", "+t.getHours().toStringZero(2)+":"+t.getMinutes().toStringZero(2);return n}return"-"}});var controll=angular.module("controllers",[]);controll.run(["$rootScope","$ionicPlatform","$ionicHistory","$rootScope","user","$location","$timeout",function(e,t,o,n,i,r,a){i.isLoginLocal()||r.path("/login-home"),e.notifCount=0,e.$on("notification",function(t,o){console.log(o,r.$$path,o.path),a(function(){o.foreground?r.$$path.indexOf(o.path)>=0?(console.log("refresh"),e.$broadcast("refresh")):"/app/pemberitahuan"==r.$$path?(e.$broadcast("refresh"),e.notifCount=0):e.notifCount++:o.path&&r.path(o.path)},1e3)})}]),controll.controller("IndexController",["$scope","$state","$ionicHistory","$location","$ionicSideMenuDelegate","user","$ionicPopover",function(e,t,o,n,i,r,a){console.info("IndexController"),e.$on("$ionicView.enter",function(e,t){}),e.$on("$ionicView.leave",function(e,t){}),e.isBackButtonShow=function(){return null!==o.backView()},e.changeState=function(e){i.isOpenLeft()&&i.toggleLeft(),t.go(e)},e.getColor=function(e){e=e||0;var t=["#F44336","#E91E63","#9C27B0","#673AB7","#3F51B5","#2196F3","#E65100","#33691E","#827717","#006064","#01579B","#009688","#424242"];return e>=t.length&&(e%=t.length),t[e]},e.getBookThumbnail=function(e){return e?e:""},e.getMemberAvatar=function(e){return e?e:"img/default-user-image.png"},a.fromTemplateUrl("menu-pop.html",{scope:e}).then(function(t){e.popTopRight=t}),e.showRightMenu=function(t){e.popTopRight.show(t)},e.$on("$destroy",function(){e.popTopRight.remove()}),e.doViewRefresh=function(){e.popTopRight.hide(),e.$broadcast("refresh")},e.doViewHelp=function(){e.popTopRight.hide(),window.open(apiUrl+"/faq","_system")}}]),controll.controller("BukuController",["$scope","$state","$ionicHistory","user","$ionicLoading","$ionicPopup","$timeout",function(e,t,o,n,i,r,a){function s(t){e.book=t,t.is_fav?e.isFavorit=!0:e.isFavorit=!1,t.is_reserve?e.isReserve=!0:e.isReserve=!1}function l(t){e.member=t;r.show({title:"Member Info",cssClass:"popup-member",templateUrl:"templates/popup-user.html",scope:e,buttons:[{text:"Tutup",type:"button-default"},{text:"Kirim Pesan",type:"button-positive",onTap:function(e){a(function(){c(t.member_id)},500)}}]})}function c(t){e.input={member_id:t,text:""};var o=r.show({title:"Kirim Pesan",cssClass:"new-message",templateUrl:"templates/popup-newmessage.html",scope:e,buttons:[{text:"Batal",type:"button-default"},{text:"Kirim",type:"button-positive",onTap:function(t){t.preventDefault(),i.show({template:"Mengirim Pesan"}),n.postMessage(e.input.member_id,e.input.text).then(function(){i.hide(),o.close()},function(e){i.hide(),"string"==typeof e&&alert(e)})}}]})}console.info("Buku Controller"),e.id=t.params.id,e.book=!1,e.isFavorit=!1,e.isReserve=!1,e.doRefresh=function(){i.show({template:"Mengambil Data Buku"}),n.getBook(e.id).then(function(e){s(e),i.hide()},function(e){i.hide(),console.log(e),t.go("app.koleksi")})},e.doRefresh(),e.toggleFav=function(){e.isFavorit?(e.isFavorit=!1,n.unsetBookFav(e.id)):(e.isFavorit=!0,n.setBookFav(e.id))},e.doReservasi=function(){e.isReserve?r.alert({title:"Reservasi",template:"Sudah direservasi."}):n.setBookReserve(e.book.biblio_id).then(function(t){r.alert({title:"Reservasi",template:t}),e.doRefresh()},function(e){"string"==typeof e&&r.alert({title:"Reservasi",template:e})})},e.dontReservasi=function(){e.isReserve?n.unsetBookReserve(e.book.biblio_id).then(function(t){e.doRefresh()},function(e){"string"==typeof e&&r.alert({title:"Reservasi",template:e})}):r.alert({title:"Reservasi",template:"Belum direservasi."})},e.doOpenUser=function(e){console.log(e),i.show({template:"Mengambil data user"}),n.getUserByMemberId(e).then(function(e){i.hide(),l(e)},function(){i.hide()})},e.doShare=function(){window.hasOwnProperty("plugins")&&window.plugins.hasOwnProperty("socialsharing")&&window.plugins.socialsharing.share(e.book.title,e.book.notes,e.book.image,webUrl+"index.php?p=show_detail&id="+e.book.biblio_id)},e.$on("refresh",function(){e.doRefresh()})}]),controll.controller("BukuReviewController",["$scope","$state","$ionicHistory","user","$ionicLoading","$ionicPopup",function(e,t,o,n,i,r){function a(t){e.book=t,t.own_rate?e.rating=t.own_rate:e.rating=0,n.getBookComments(e.id).then(function(t){e.comments=t})}console.info("Buku Controller"),e.id=t.params.id,e.book=!1,e.rating=0,e.comments=[],e.input={comment:""},e.doRefresh=function(){i.show({template:"Mengambil Data Buku"}),n.getBook(e.id).then(function(e){a(e),i.hide()},function(e){i.hide(),console.log(e),t.go("app.koleksi")})},e.doRefresh(),e.setRating=function(t){e.rating=t,n.setBookRate(e.id,t).then(function(e){console.log("Set Rate Success")})},e.doSendComment=function(){e.input.comment||r.alert({title:"Data tidak lengkap",template:"Kolom komentar harus diisi."}),n.setBookComments(e.id,e.input.comment).then(function(t){e.comments.unshift(t),e.input.comment=""},function(e){"string"==typeof e&&r.alert({title:"Gagal mengirim komentar",template:e})})},e.$on("refresh",function(){e.doRefresh()})}]),controll.controller("FavoritController",["$scope","$state","$ionicHistory","$ionicLoading","user",function(e,t,o,n,i){console.info("FavoritController");var r=0,a=10,s={offset:r,limit:a,favorit:1};e.books=[],e.total=0,e.search={text:""},e.openBook=function(e){t.go("app.buku",{id:e})},o.clearHistory(),e.doRefresh=function(t){n.show({template:"Mengambil Buku"}),i.getBooks(s).then(function(o){t?e.books=o.results:e.books=e.books.concat(o.results),e.total=o.params.total,n.hide()},function(){n.hide()})},e.doRefresh(),e.doLoadMore=function(){r+=a,s.limit=a,s.offset=r,e.doRefresh()},e.canLoadMore=function(){return r+a<e.total},e.doSearch=function(){r=0,a=10,s={offset:r,limit:a,title:e.search.text},e.doRefresh(!0)},e.doReset=function(){r=0,a=10,s={offset:r,limit:a,favorit:1},e.doRefresh(!0)},e.$on("$ionicView.enter",function(){e.doReset()}),e.$on("refresh",function(){e.doReset()})}]),controll.controller("SendFeedbackController",["$scope","$state","$ionicHistory","user",function(e,t,o,n){console.info("SendFeedbackController"),o.clearHistory()}]),controll.controller("KoleksiController",["$scope","$state","$ionicHistory","$ionicLoading","user","$ionicSideMenuDelegate",function(e,t,o,n,i,r){console.info("Koleksi Controller");var a=0,s=10,l={offset:a,limit:s};e.sectionTitle="",e.books=[],e.total=0,e.search={text:""},e.topics=[],i.getTopics().then(function(t){e.topics=t}),e.openBook=function(e){t.go("app.buku",{id:e})},o.clearHistory(),e.doRefresh=function(t){n.show({template:"Mengambil Buku"}),i.getBooks(l).then(function(o){t?e.books=o.results:e.books=e.books.concat(o.results),e.total=o.params.total,o.params&&o.params.topic_name?e.sectionTitle="Kategori : "+o.params.topic_name.toTitleCase():o.params&&o.params.title?e.sectionTitle="Pencarian : "+o.params.title.toTitleCase():e.sectionTitle=!1,n.hide()},function(){n.hide()})},e.doRefresh(),e.doLoadMore=function(){a+=s,l.limit=s,l.offset=a,e.doRefresh()},e.canLoadMore=function(){return a+s<e.total},e.doSearch=function(){a=0,s=10,l={offset:a,limit:s,title:e.search.text},e.doRefresh(!0)},e.doOpenTopic=function(t){a=0,s=10,l={offset:a,limit:s,topic:t},e.doRefresh(!0)},e.doReset=function(){a=0,s=10,l={offset:a,limit:s},e.doRefresh(!0)},e.$on("refresh",function(){e.doReset()}),e.onTopicDown=function(){r.canDragContent(!1)},e.onTopicUp=function(){r.canDragContent(!0)},e.getBG=function(e){var t=["#daedf2","#a5f7b3","#f7f1a5","#f7a5a5","#c9bbf3","#f3bbe2"];return t[e%t.length]}}]),controll.controller("LoginController",["$scope","$location","$state","$ionicHistory","user","$ionicPopup","$ionicLoading",function(e,t,o,n,i,r,a){console.info("LoginController"),n.clearHistory(),e.data={username:"",password:""},e.doLogin=function(){console.log("login",e.data.username),""===e.data.username?r.alert({template:"Username / Email tidak boleh kosong.",title:"Data Tidak Lengkap"}):""===e.data.password?r.alert({template:"Password tidak boleh kosong.",title:"Data Tidak Lengkap"}):(a.show({template:"Memproses Login"}),i.login(e.data.username,e.data.password).then(function(e){o.go("app.koleksi"),a.hide()},function(e){a.hide(),r.alert({template:e,title:"Gagal"})}))},e.openRegister=function(){o.go("register")}}]),controll.controller("RegisterController",["$scope","$location","$state","$ionicHistory","user","$ionicPopup","$ionicLoading",function(e,t,o,n,i,r,a){console.log("RegisterController"),e.data={member_id:"",member_name:"",email:"",member_phone:"",password:""},e.openLogin=function(){o.go("login")},e.doRegister=function(){var t=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;!e.data.member_id||e.data.member_id.length<5?r.alert({template:"Member ID tidak boleh kosong. Minimal 5 Karakter.",title:"Data Tidak Lengkap"}):!e.data.member_name||e.data.member_name.length<5?r.alert({template:"Nama Lengkap tidak boleh kosong. Minimal 5 Karakter.",title:"Data Tidak Lengkap"}):e.data.email?t.test(e.data.email)?!e.data.member_phone&&e.data.member_phone.length<5?r.alert({template:"Nomor HP tidak boleh kosong.",title:"Data Tidak Lengkap"}):!e.data.password||e.data.password.length<6||e.data.password!=e.data.password2?r.alert({template:"Password tidak boleh kosong dan minimal mengandung 6 karakter. Kedua password harus sama.",title:"Data Tidak Lengkap"}):(a.show({template:"Memproses Registrasi"}),i.register(e.data).then(function(){o.go("app.koleksi"),a.hide()},function(e){a.hide(),a.hide(),r.alert({template:e,title:"Gagal"})})):r.alert({template:"Format Email tidak benar.",title:"Data Tidak Lengkap"}):r.alert({template:"Email tidak boleh kosong.",title:"Data Tidak Lengkap"})}}]),controll.controller("PemberitahuanController",["$rootScope","$scope","$state","$ionicHistory","user","$ionicLoading",function(e,t,o,n,i,r){function a(){for(var e=[],o=0;o<t.notifs.data.length;o++)"0"===t.notifs.data[o].is_read&&e.push(t.notifs.data[o].id);e.length&&i.postNotifRead(e).then(function(e){console.log("Notif Read",e)},function(){})}console.info("PemberitahuanController"),n.clearHistory(),t.notifs=[],t.doRefresh=function(){r.show({template:"Mengambil Data Notifikasi"}),i.getNotif().then(function(e){t.notifs=e,a(),r.hide()},function(){r.hide()})},t.$on("refresh",function(){t.doRefresh()}),t.doRefresh(),t.$on("$ionicView.enter",function(){e.notifCount=0,t.doRefresh()}),t.doOpen=function(e){0===e.text.indexOf("mengirim pesan")&&o.go("app.pesan-single",{member_id:e.from_id})}}]),controll.controller("PengaturanController",["$scope","$state","$location","$ionicHistory","user",function(e,t,o,n,i){console.info("PengaturanController"),n.clearHistory(),e.setting={notif_email:"1"==i.profile.setting.notif_email,notif_app:"1"==i.profile.setting.notif_app},e.$on("$ionicView.enter",function(){e.setting={notif_email:"1"==i.profile.setting.notif_email,notif_app:"1"==i.profile.setting.notif_app}}),e.doUpdateSetting=function(){var t={notif_email:e.setting.notif_email?"1":"0",notif_app:e.setting.notif_app?"1":"0"};i.updateUserSetting(t)},e.doLogout=function(){i.logout(),o.path("/login")},e.doOpenAbout=function(){t.go("app.about")},e.doOpenSupport=function(){t.go("app.support")}}]),controll.controller("PesanSingleController",["$scope","$state","user","$ionicLoading","$ionicPopup","$stateParams","$ionicScrollDelegate",function(e,t,o,n,i,r,a){console.info("PesanController");var s=a.$getByHandle("chatScroll");r.member_id||t.go("app.pesan"),e.member_id=r.member_id,e.text="",e.messages=[],e.doRefresh=function(){n.show({template:"Mengambil Pesan"}),o.getMessageTexts(r.member_id).then(function(t){e.messages=t,s.scrollBottom(),n.hide()},function(){n.hide()})},e.doRefresh(),e.sendMessage=function(){n.show({template:"Mengirim Pesan"}),o.postMessage(r.member_id,e.text).then(function(){n.hide(),e.text="",e.doRefresh()},function(){n.hide()})},e.$on("refresh",function(){e.doRefresh()})}]),controll.controller("PesanController",["$scope","$state","$ionicHistory","user","$ionicLoading","$ionicPopup",function(e,t,o,n,i,r){console.info("PesanController"),o.clearHistory(),e.messages=[],e.doRefresh=function(){i.show({template:"Mengambil Daftar Pesan"}),n.getMessageList().then(function(t){e.messages=t,i.hide()},function(){i.hide()})},e.$on("refresh",function(){e.doRefresh()}),e.doRefresh(),e.newMessage=function(){e.input={member_id:"",text:""};var t=r.show({title:"Kirim Pesan",cssClass:"new-message",templateUrl:"templates/popup-newmessage.html",scope:e,buttons:[{text:"Batal",type:"button-default"},{text:"Kirim",type:"button-positive",onTap:function(o){o.preventDefault(),i.show({template:"Mengirim Pesan"}),n.postMessage(e.input.member_id,e.input.text).then(function(){i.hide(),t.close(),e.doRefresh()},function(e){i.hide(),"string"==typeof e&&alert(e)})}}]})},e.openChat=function(e){t.go("app.pesan-single",{member_id:e})}}]),controll.controller("PinjamanController",["$scope","$state","$ionicHistory","user",function(e,t,o,n){console.info("PinjamanController"),e.books=[],e.doRefresh=function(){n.getBookLoans().then(function(t){console.log(t),e.books=t})},e.doRefresh(),e.$on("$ionicView.enter",function(){e.doRefresh()}),e.$on("refresh",function(){e.doRefresh()}),e.openBook=function(e){t.go("app.buku",{id:e})}}]),controll.controller("ProfilController",["$scope","$state","$ionicHistory","user","$ionicLoading","$timeout","$ionicPopup",function(e,t,o,n,i,r,a){function s(e){if(FileUploadOptions&&FileTransfer){i.show({template:"Ganti Profil"});var t=new FileUploadOptions;t.fileKey="file",t.fileName=e.substr(e.lastIndexOf("/")+1),t.mimeType="image/jpg";var o={token:n.getKey()};t.headers=o;var s=new FileTransfer;s.upload(e,encodeURI(apiUrl+"user/avatar"),function(e){i.hide();try{var t=JSON.parse(e.response);if(t.status)return void r(function(){n.profile.member_image=t.data},200);alert("gagal : "+e.response)}catch(o){alert("error : "+e.response)}},function(){i.hide(),a.alert({template:"Ganti Avatar Gagal.",title:"Gagal"})},t)}else a.alert("Kesalahan pengolahan gambar.")}console.info("ProfilController"),o.clearHistory(),e.edit={member_name:n.profile.member_name,member_phone:n.profile.member_phone,member_address:n.profile.member_address},e.isEditPhone=!1,e.editPhone=function(){e.isEditPhone||(e.edit.member_phone=n.profile.member_phone,e.isEditPhone=!0)},e.isEditAddress=!1,e.editAddress=function(){e.isEditAddress||(e.edit.member_address=n.profile.member_address,e.isEditAddress=!0)},e.isEditName=!1,e.editName=function(){e.isEditName||(e.edit.member_name=n.profile.member_name,e.isEditName=!0)},e.saveBio=function(){i.show({template:"Menyimpan Biodata"}),n.saveBio(e.edit).then(function(){n.profile.member_phone=e.edit.member_phone,n.profile.member_address=e.edit.member_address,n.profile.member_name=e.edit.member_name,e.isEditPhone=!1,e.isEditAddress=!1,e.isEditName=!1,i.hide()},function(){i.hide()})},e.doChangeAvatar=function(){window.imagePicker?window.imagePicker.getPictures(function(e){e.length>0?s(e[0]):alert("Image Not Detected")},function(e){alert("Error: "+e)},{maximumImagesCount:1,width:200}):(alert("tanpa imagePicker"),document.getElementById("userImageEl").click())},e.changeImage=function(e){if(e.files.length>0){var t=e.files[0];i.show({template:"Ganti Profil"}),n.changeAvatar(t).then(function(e){i.hide(),r(function(){n.profile.member_image=e},200)},function(e){i.hide(),"string"==typeof e?a.alert({template:e,title:"Gagal"}):a.alert({template:"Gagal ganti avatar",title:"Gagal"})})}}}]),controll.controller("ReservasiController",["$scope","$state","$ionicHistory","user",function(e,t,o,n){console.info("ReservasiController"),e.books=[],e.doRefresh=function(){n.getBookReserve().then(function(t){console.log(t),e.books=t})},e.doRefresh(),e.$on("$ionicView.enter",function(){e.doRefresh()}),e.$on("refresh",function(){e.doRefresh()}),e.openBook=function(e){console.log("Open "+e),t.go("app.buku",{id:e})}}]),controll.controller("SupportController",["$scope","$state","$location","$ionicHistory","user","$ionicLoading","$ionicPopup",function(e,t,o,n,i,r,a){console.info("SupportController"),e.input={text:""},e.doSend=function(){e.input.text&&(r.show({template:"Mengirim Pesan"}),i.sendReport(e.input.text).then(function(){e.input.text="",r.hide(),a.alert({title:"Berhasil",template:"Pertanyaan / saran telah terkirim. Mohon tunggu untuk balasan lebih lanjut dari kami melalui kotak pesan."})},function(){r.hide()}))}}]);
//# sourceMappingURL=digilib.min.js.map
